---
title: bedbaser
author:
- name: J Wokaty
  affiliation: CUNY School of Public Health
  email: jennifer.wokaty@sph.cuny.edu
package: bedbaser
output: 
  BiocStyle::html_document
vignette: >
  %\VignetteIndexEntry{bedbaser}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}  
---

# Introduction

```{r library, include=FALSE}
library(bedbaser)
```

bedbaser is an R client for [BEDbase](https://bedbase.org) that provides access
to the [BEDbase API](https://api.bedbase.org) and includes convenience functions
to create GRanges and GRangesList objects.

# Install bedbaser

Install bedbaser using `r CRANpkg("BiocManager")`.

```{r install, eval=FALSE}
if (!"BiocManager" %in% rownames(installed.packages()))
    install.packages("BiocManager")
BiocManager::install("bedbaser", dependencies=TRUE)
```

# Create a bedbaser client

bedbaser uses the `r Biocpkg("AnVIL")` Service class to create a `BEDbase`
client, which allows access to the API directly.

```{r bedbase}
client <- BEDbase()
show(client)
```

End points can be accessed with `$` and their results can be retrieved
with `r CRANpkg("httr")`.

```{r count_bed_record_bed_count_get}
library(httr)
rsp <- client$get_example_bed_record_v1_bed_example_get()
example_bed <- content(rsp)
```

bedbaser includes convenience functions prefixed with *bb_* to facilitate
finding BEDs, exploring their metadata, and download files.

# Find a BED file or BEDset

Use `bb_list()` to browse available resources in BEDbase. `bb_list()`
displays the record identifiers and names of BED files and BEDsets.
Record identifiers can be used to access a specific resource.

```{r bb_list_beds}
bb_list_beds(client)

bb_list_bedsets(client)
```

# Examine metadata

Use `bb_metadata()` to learn more about a BED or BEDset associated with
a record identifier.

```{r bb_metadata}
md <- bb_metadata(client, example_bed$id, "bed")
head(md)
```

# Show BED files in BEDset

Use `bb_beds_in_bedset()` to display the record identifiers of BEDs in a
BEDset. 

```{r bb_beds_in_bedset}
bb_beds_in_bedset(client, "excluderanges")
```

# Search for a BED file by keyword

Search for BED files by keywords. `bb_bed_text_search()` returns all BED files
scored against a query.

```{r bb_search}
bb_bed_text_search(client, "cancer", limit = 10)
```

# Import a BED into a GRanges object

`bb_to_granges` downloads and imports a BED file using `rtracklayer` to
create a `GRanges` object when given a BED file record identifier. 
`bb_to_granges` also attempts to pass the genome to `rtracklayer`

```{r bb_to_granges}
ex_bed <- bb_example(client, "bed")
head(ex_bed)
# Allow bedbaser to assign column names and types
bb_to_granges(client, ex_bed$id, "bed")
```

For BEDX+Y formats, a named list with column types may be passed through
`extra_cols` if the column name and type are known. Otherwise, `bb_to_granges`
guesses the column types and assigns column names.

```{r bb_to_granges_manual, eval=FALSE}
# Manually assign column name and type using `extra_cols`
bb_to_granges(client, ex_bed$id, "bed", extra_cols = c("column_name" = "character"))
```

`bb_to_granges` automatically assigns the column names and types for broad peak
and narrow peak files.

```{r bb_to_granges_narrowpeak}
bed_id <- "bbad85f21962bb8d972444f7f9a3a932"
md <- bb_metadata(client, bed_id, "bed")
head(md)
bb_to_granges(client, bed_id, "bed")
```

`bb_to_granges` can also import big BED files.

```{r bb_to_granges_big_bed}
ex_bed <- bb_example(client, "bed")
bb_to_granges(client, ex_bed$id, "bigbed")
```

# Import a BEDset into a GRangesList

`bb_to_grangeslist` creates a `GRangesList` object given a BEDset record
identifier.

```{r bb_to_grangeslist}
bedset_id <- "lola_hg38_ucsc_features"
bb_to_grangeslist(client, bedset_id)
```

# SessionInfo()

```{r sessionInfo}
sessionInfo()
```
